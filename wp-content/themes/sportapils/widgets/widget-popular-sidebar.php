<?phpclass widget_popular_sidebar extends WP_Widget {    /*  Widget #2 Setup  */    public function __construct() {        parent::__construct(false, $name = esc_html__('Sportapils popular posts sidebar', 'sportapils' ), array(            'description' => esc_html__('Widget for displaying popular posts', 'sportapils' )        ));    }    /*  Display Widget #2  */    public function widget( $args, $instance ) {        if ( ! isset( $args['widget_id'] ) ) {            $args['widget_id'] = $this->id;        }        $title = ( ! empty( $instance['title'] ) ) ? $instance['title'] : '';        $title = apply_filters( 'widget_title', $title, $instance, $this->id_base );        $popular_days = $instance['popular_days'];        $number = ( ! empty( $instance['number'] ) ) ? absint( $instance['number'] ) : 4;        $adImage = ( ! empty( $instance['image_uri'] ) ) ? $instance['image_uri'] : '';        if($adImage) {            $adUrl = ( ! empty( $instance['ad_url'] ) ) ? $instance['ad_url'] : '';            $adText = ( ! empty( $instance['ad_text'] ) ) ? $instance['ad_text'] : '';        }        $numberFormatter = new NumberFormatter("en", NumberFormatter::SPELLOUT);        if ( ! $number ) {            $number = 4;        }        $popular_days_ago = "$popular_days days ago";        $recent = new WP_Query(array(            'posts_per_page' => ($adImage ? $number - 1 : $number) ,            'orderby' => 'meta_value_num',            'order' => 'DESC',            'meta_key' => 'post_views_count',            'date_query' => array( array( 'after' => $popular_days_ago )) ));        $n = 1;        if ($recent->have_posts()) :            ?>            <div class="relative">                <?php if ( $title ) { ?>                    <div class="main-title centered">                        <div class="colored-icon"></div><span class="relative"><?php echo esc_html($title); ?></span>                    </div>                <?php } ?>                <div class="hexagon-list sidebar relative centered <?php echo $numberFormatter->format($number) ;?>">                    <?php while($recent->have_posts()) : $recent->the_post(); ?>                        <?php $hexagon_image = wp_get_attachment_image_src(get_post_meta( get_the_ID(), 'hexagon_featured_image', true), 'full');                        if(!$hexagon_image) $hexagon_image = wp_get_attachment_image_src(get_post_thumbnail_id(), 'full');                        if ($hexagon_image) { ?>                            <a href="<?php the_permalink(); ?>" title="<?php the_title_attribute(); ?>"                               class="hexagon small left <?php if ($n == 5) echo 'grey';?>"                               style="background-image: url(<?php echo esc_url($hexagon_image[0]); ?>);">                                <div class="overlay"></div>                                <div class="content">                                    <div class="info">                                        <span class="date"><?php echo get_the_date(); ?></span>                                        <span class="author">@<?php echo get_the_author_meta('display_name');?></span>                                    </div>                                    <div class="title-wrapper">                                        <span class="title"><?php echo get_the_title() ?  esc_html(wp_trim_words( the_title('', '', false), 7, ' ...' )) : the_ID(); ?></span>                                    </div>                                    <div class="description-wrapper">                                        <span class="description">                                            <?php echo esc_html(wp_trim_words( get_the_excerpt(), 22, ' ...' )); ?>                                        </span>                                    </div>                                </div>                                <div class="hexTop">                                    <div class="overlay"></div>                                </div>                                <div class="hexBottom">                                    <div class="overlay"></div>                                </div>                            </a>                        <?php }                        $n++; ?>                    <?php endwhile; ?>                    <?php if($adImage) { ?>                        <a href="<?php echo $adUrl; ?>" class="hexagon small ad left"                        style="background-image: url(<?php echo esc_url($adImage); ?>);">                        <div class="overlay"></div>                        <div class="content">                            <div class="title-wrapper">                                <span class="title"><?php echo wp_trim_words( $adText, 10, ' ...' ); ?></span>                            </div>                        </div>                        <div class="hexTop">                            <div class="overlay"></div>                        </div>                        <div class="hexBottom">                            <div class="overlay"></div>                        </div>                        </a>                    <?php } ?>                </div>                <div class="clearfix"></div>            </div>            <?php            wp_reset_postdata();        endif;    }    /*  Update Widget #2  */    function update( $new_instance, $old_instance ) {        $instance = $old_instance;        /* Strip tags for title and name to remove HTML (important for text inputs). */        $instance['title'] = strip_tags( $new_instance['title'] );        $instance['popular_days'] = strip_tags( $new_instance['popular_days'] );        $instance['number'] = strip_tags( $new_instance['number'] );        $instance['image_uri'] = strip_tags( $new_instance['image_uri'] );        $instance['ad_text'] = strip_tags( $new_instance['ad_text'] );        $instance['ad_url'] = strip_tags( $new_instance['ad_url'] );        return $instance;    }    /*  Widget #2 Settings Form  */    function form( $instance ) {        /* Set up some default widget settings. */        $defaults = array( 'title' => 'Title', 'number' => 5, 'popular_days' => 30 );        $instance = wp_parse_args( (array) $instance, $defaults ); ?>        <!-- Widget Title: Text Input -->        <p>            <label for="<?php echo $this->get_field_id( 'title' ); ?>">Title:</label>            <input id="<?php echo $this->get_field_id( 'title' ); ?>" name="<?php echo $this->get_field_name( 'title' ); ?>" value="<?php echo $instance['title']; ?>" style="width:90%;" />        </p>        <!-- Number of days -->        <p>            <label for="<?php echo $this->get_field_id( 'popular_days' ); ?>">Number of days to use for Trending topics:</label>            <input id="<?php echo $this->get_field_id( 'popular_days' ); ?>" name="<?php echo $this->get_field_name( 'popular_days' ); ?>" value="<?php echo $instance['popular_days']; ?>" size="3" />        </p>        <!-- Number of posts -->        <p>            <label for="<?php echo $this->get_field_id( 'number' ); ?>">Number of posts to display:</label>            <input id="<?php echo $this->get_field_id( 'number' ); ?>" name="<?php echo $this->get_field_name( 'number' ); ?>" value="<?php echo $instance['number']; ?>" size="3" />        </p>        <!-- Ad content -->        <p>            <label for="<?php echo $this->get_field_id('image_uri'); ?>"><?php esc_html_e( 'Ad Image:', 'sportapils' ); ?></label><br />            <input type="text" class="widefat <?= $this->id ?>_url" name="<?= $this->get_field_name( 'image_uri' ); ?>" value="<?= $instance['image_uri']; ?>" style="margin-top:5px;" />            <img class="<?= $this->id ?>_img" src="<?= (!empty($instance['image_uri'])) ? $instance['image_uri'] : ''; ?>" style="margin:0;padding:0;max-width:100%;display:block"/>            <input type="button" id="<?= $this->id ?>" class="button button-primary js_custom_upload_media" value="Upload Image" style="margin-top:5px;" />        </p>        <p>            <label for="<?php echo $this->get_field_id('ad_url'); ?>"><?php esc_html_e( 'Ad Url:', 'sportapils' ); ?></label>            <input type="text" name="<?php echo $this->get_field_name('ad_url'); ?>" id="<?php echo $this->get_field_id('ad_url'); ?>" value="<?php echo $instance['ad_url']; ?>" class="widefat" />        </p>        <p>            <label for="<?php echo $this->get_field_id('ad_text'); ?>"><?php esc_html_e( 'Ad Text:', 'sportapils' ); ?></label>            <input type="text" name="<?php echo $this->get_field_name('ad_text'); ?>" id="<?php echo $this->get_field_id('ad_text'); ?>" value="<?php echo $instance['ad_text']; ?>" class="widefat" />        </p>        <script type="text/javascript">            jQuery(document).ready(function ($) {                function media_upload(button_selector) {                    var _custom_media = true,                        _orig_send_attachment = wp.media.editor.send.attachment;                    $('body').on('click', button_selector, function () {                        var button_id = $(this).attr('id');                        wp.media.editor.send.attachment = function (props, attachment) {                            if (_custom_media) {                                $('.' + button_id + '_img').attr('src', attachment.url);                                $('.' + button_id + '_url').val(attachment.url);                            } else {                                return _orig_send_attachment.apply($('#' + button_id), [props, attachment]);                            }                        };                        wp.media.editor.open($('#' + button_id));                        return false;                    });                }                media_upload('.js_custom_upload_media');            });        </script>        <?php    }}add_action( 'widgets_init', 'widget_popular_sidebar_register' );function widget_popular_sidebar_register() {    register_widget( 'widget_popular_sidebar' );}